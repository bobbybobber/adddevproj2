{% extends "base.html" %}
{% block additional_css %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
{% endblock %}

{% block title %}MonsterBob - Home{% endblock %}

{% block content %}
<div class="search-container">
    <input type="text" id="searchInput" onkeyup="searchFunction()" placeholder="Search for blog posts...">
</div>
<div id="searchResults">
</div>
<div class="card-deck" id="blog-container">
    {% include 'partials/blog_list.html' %}
</div>
<div class="pagination-container">
    {% for i in range(1, total_pages + 1) %}
    {% if i == current_page %}
    <span class="current-page"><strong>{{ i }}</strong></span>
    {% else %}
    <a href="javascript:void(0);" onclick="loadPage({{ i }})">{{ i }}</a>
    {% endif %}
    {% endfor %}
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>
    function searchFunction(event) {
        if (event.key === "Enter") {
            let input = document.getElementById('searchInput').value.trim();
            if (input !== '') {
                // Use AJAX to fetch data without reloading the page
                $.ajax({
                    url: `/about?search=${encodeURIComponent(input)}&page=1`,
                    type: 'GET',
                    success: function(response) {
                        // Update the HTML with the new content
                        document.getElementById('blog-container').innerHTML = response;
                    },
                    error: function(error) {
                        console.error("Error fetching data:", error);
                    }
                });
            }
        }
    }

    document.getElementById('searchInput').addEventListener('keypress', searchFunction);



</script>
<script>
    function loadPage(pageNumber) {
        $.ajax({
            url: `/about?page=${pageNumber}`, // Adjust the URL as needed
            type: 'GET',
            success: function(response) {
                // Replace the content of the blog-container with new content
                document.getElementById('blog-container').innerHTML = response;
                // Update the current page in pagination
                updatePagination(pageNumber);
            },
            error: function(error) {
                console.error("Error fetching page:", error);
            }
        });
    }

    function updatePagination(currentPage) {
        const paginationContainer = document.querySelector('.pagination-container');

        // Remove current-page class from all links and spans
        paginationContainer.querySelectorAll('.current-page').forEach(element => {
            element.classList.remove('current-page');
            if (element.tagName === 'SPAN') {
                const pageNumber = element.innerText;
                const newLink = document.createElement('a');
                newLink.href = `javascript:void(0);`;
                newLink.onclick = function() { loadPage(parseInt(pageNumber)); };
                newLink.innerText = pageNumber;
                element.replaceWith(newLink);
            }
        });

        // Find the link for the current page and replace it with a span
        const currentPageLink = paginationContainer.querySelector(`a[href='javascript:void(0);'][onclick='loadPage(${currentPage})']`);
        if (currentPageLink) {
            const currentSpan = document.createElement('span');
            currentSpan.classList.add('current-page');
            currentSpan.innerText = currentPage;
            currentPageLink.replaceWith(currentSpan);
        }
    }
</script>
{% endblock %}
